package main

import (
	"errors"
	"fmt"
	"log"
	"os/exec"
	"reflect"
)

type winCmds struct {
	name     string
	funcName interface{}
	cmd      string
}

type cmdMap map[string]interface{}

var cmdNames = cmdMap{}

func main() {
	var cmdList = []winCmds{
		// {
		// 	name:     "SystemInfo",
		// 	funcName: SystemInfo,
		// 	cmd:      "systeminfo",
		// },
		// {
		// 	name:     "Uptime",
		// 	funcName: Uptime,
		// 	cmd:      "wmic path win32_operatingsystem get lastbootuptime /format:csv",
		// },
		// {
		// 	name:     "OS",
		// 	funcName: OS,
		// 	cmd:      "wmic os get version /format:csv",
		// },
		// {
		// 	name:     "CPU",
		// 	funcName: CPU,
		// 	cmd:      "wmic cpu",
		// },
		// {
		// 	name:     "MEM",
		// 	funcName: MEM,
		// 	cmd:      "wmic memphysical",
		// },
		// {
		// 	name:     "IP",
		// 	funcName: IP,
		// 	cmd:      "netsh interface ip show address",
		// },
		// {
		// 	name:     "MAC",
		// 	funcName: MAC,
		// 	cmd:      "wmic nic",
		// },
		// {
		// 	name:     "Disks",
		// 	funcName: Disks,
		// 	cmd:      "wmic diskdrive",
		// },
		{
			name:     "Users",
			funcName: Users,
			cmd:      "wmic useraccount get name",
		},
		{
			name:     "Users",
			funcName: Users,
			cmd:      "wmic useraccount get sid",
		},
		// {
		// 	name:     "Apps",
		// 	funcName: Apps,
		// 	cmd:      "wmic product",
		// },
		// {
		// 	name:     "Services",
		// 	funcName: Services,
		// 	cmd:      "wmic service",
		// },
		// {
		// 	name:     "Patches",
		// 	funcName: Patches,
		// 	cmd:      "wmic qfe",
		// },
		// {
		// 	name:     "Startup",
		// 	funcName: Startup,
		// 	cmd:      "wmic startup",
		// },
		// {
		// 	name:     "ScheduledTasks",
		// 	funcName: ScheduledTasks,
		// 	cmd:      "schtasks",
		// },
	}

	cmdNames = map[string]interface{}{}

	for _, v := range cmdList {
		MapCmdNames(v.name, v.funcName)
	}

	for i := 0; i < len(cmdList); i++ {
		output, err := exec.Command("cmd", "/c", cmdList[i].cmd).Output()

		if err != nil {
			log.Fatal(err)
		}
		// splitStr := strings.Split(string(output), ",")
		// fmt.Println(splitStr[0])
		testCall, _ := CallFunc(cmdList[i].name, string(output))
		var printCall string
		printCall = testCall.(string)
		fmt.Println(printCall)
	}

	// fmt.Println(runtime.GOOS)
}

func MapCmdNames(name string, funcName interface{}) {
	cmdNames[name] = funcName
}

func CallFunc(funcName string, params ...interface{}) (result interface{}, err error) {
	f := reflect.ValueOf(cmdNames[funcName])
	if len(params) != f.Type().NumIn() {
		err = errors.New("The number of params is out of index.")
		return
	}
	in := make([]reflect.Value, len(params))
	for k, param := range params {
		in[k] = reflect.ValueOf(param)
	}
	var res []reflect.Value
	res = f.Call(in)
	result = res[0].Interface()
	return
}

func SystemInfo(raw_output string) string {
	fmt.Println("0")
	return (raw_output)
}
func Uptime(raw_output string) string {
	fmt.Println("1")
	return (raw_output)
}
func OS(raw_output string) string {
	fmt.Println("2")
	return (raw_output)
}
func CPU(raw_output string) string {
	fmt.Println("3")
	return (raw_output)
}
func MEM(raw_output string) string {
	fmt.Println("4")
	return (raw_output)
}
func IP(raw_output string) string {
	fmt.Println("5")
	return (raw_output)
}
func MAC(raw_output string) string {
	fmt.Println("6")
	return (raw_output)
}
func Disks(raw_output string) string {
	fmt.Println("7")
	return (raw_output)
}
func Users(raw_output string) string {
	fmt.Println("8")
	return (raw_output)
}
func Apps(raw_output string) string {
	fmt.Println("9")
	return (raw_output)
}
func Services(raw_output string) string {
	fmt.Println("10")
	return (raw_output)
}
func Patches(raw_output string) string {
	fmt.Println("11")
	return (raw_output)
}
func Startup(raw_output string) string {
	fmt.Println("12")
	return (raw_output)
}
func ScheduledTasks(raw_output string) string {
	fmt.Println("13")
	return (raw_output)
}
